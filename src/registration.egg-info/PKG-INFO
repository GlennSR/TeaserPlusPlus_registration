Metadata-Version: 2.4
Name: registration
Version: 0.1.0
Summary: Point cloud registration using Open3D
Requires-Python: >=3.12
Description-Content-Type: text/markdown
Requires-Dist: numpy>=2.3.4
Requires-Dist: open3d>=0.19.0
Requires-Dist: ruff>=0.14.1
Provides-Extra: test
Requires-Dist: pytest>=8.0.0; extra == "test"
Requires-Dist: pytest-cov>=4.1.0; extra == "test"
Provides-Extra: docs
Requires-Dist: sphinx>=7.0.0; extra == "docs"
Requires-Dist: sphinx-rtd-theme>=2.0.0; extra == "docs"
Requires-Dist: sphinx-autodoc-typehints>=1.25.0; extra == "docs"

# Point Cloud Registration

[![CI](https://github.com/simogasp/pc_registration/actions/workflows/ci.yml/badge.svg)](https://github.com/simogasp/pc_registration/actions/workflows/ci.yml)
[![Tests](https://github.com/simogasp/pc_registration/actions/workflows/test.yml/badge.svg)](https://github.com/simogasp/pc_registration/actions/workflows/test.yml)
[![Python 3.12+](https://img.shields.io/badge/python-3.12+-blue.svg)](https://www.python.org/downloads/)
[![Code style: ruff](https://img.shields.io/badge/code%20style-ruff-000000.svg)](https://github.com/astral-sh/ruff)
[![codecov](https://codecov.io/gh/simogasp/pc_registration/graph/badge.svg?token=V51VN2ARZN)](https://codecov.io/gh/simogasp/pc_registration)
[![Codacy Badge](https://app.codacy.com/project/badge/Grade/8919a02c718c48939afae78e49653184)](https://app.codacy.com/gh/simogasp/pc_registration/dashboard?utm_source=gh&utm_medium=referral&utm_content=&utm_campaign=Badge_grade)
[![FOSSA Status](https://app.fossa.com/api/projects/git%2Bgithub.com%2Fsimogasp%2Fpc_registration.svg?type=shield)](https://app.fossa.com/projects/git%2Bgithub.com%2Fsimogasp%2Fpc_registration?ref=badge_shield)

This project provides implementations of various point cloud registration algorithms using Open3D, including:

- **ICP (Iterative Closest Point)**: Point-to-point and point-to-plane variants
- **Global Registration**: RANSAC-based feature matching with FPFH features
- **Point Cloud Visualization**: Load and display point clouds with bounding boxes

## Project Structure

```none
registration/
├── src/
│   └── registration/          # Main package
│       ├── utils/             # Utility modules
│       │   ├── logging.py     # Colored logging configuration
│       │   ├── transforms.py  # Rotation and transformation utilities
│       │   └── metrics.py     # RMSE and error metrics
│       └── visualization/
│           └── viewer.py      # Point cloud visualization
├── scripts/                   # Experimental/executable scripts
│   ├── global_registration.py # RANSAC + ICP pipeline
│   ├── icp_vanilla.py         # Simple ICP registration
│   └── load_and_display.py    # Point cloud viewer
├── tests/                     # Unit tests
│   ├── utils/
│   │   └── test_transforms.py
│   └── conftest.py
├── reports/                   # Test coverage reports
└── pyproject.toml             # Project configuration
```

## Prerequisites

- Python 3.12 or higher
- [uv](https://github.com/astral-sh/uv) (recommended) or `pip`

## Setup Instructions

### Option 1: Using uv (Recommended)

[uv](https://github.com/astral-sh/uv) is a fast Python package installer and resolver that manages dependencies and virtual environments automatically.

#### Install uv

```bash
# On macOS and Linux
curl -LsSf https://astral.sh/uv/install.sh | sh

# On Windows
powershell -c "irm https://astral.sh/uv/install.ps1 | iex"

# Or with pip
pip install uv
```

#### Set up the project

```bash
# Clone the repository
git clone <repository-url>
cd registration


# Automatically sync all dependencies and install in editable mode
# with uv
uv sync --extra test

# or with pip
uv pip install -e ".[test]"
```

> [!NOTE]
> The `-e` flag installs the package in "editable mode", meaning changes to the source code are immediately reflected without reinstalling. This is perfect for development!

That's it! uv will:

- Create a virtual environment in `.venv/`
- Install all dependencies from `pyproject.toml`
- Install the `registration` package in editable mode
- Install testing dependencies

### Option 2: Using pip (Traditional Method)

```bash
# Clone the repository
git clone <repository-url>
cd registration

# Create a virtual environment
python3 -m venv .venv

# Activate the virtual environment
# On macOS/Linux:
source .venv/bin/activate
# On Windows:
.venv\Scripts\activate

# Install the package in editable mode
pip install -e ".[test]"
```

## Usage

### Running Scripts with uv

With uv, you don't need to activate the virtual environment manually. Just prefix commands with `uv run`:

#### 1. Global Registration (RANSAC + ICP)

```bash
uv run python scripts/global_registration.py \
  --source data/source.ply \
  --target data/target.ply \
  --voxel-size 0.05 \
  -v INFO
```

**Options:**

- `--source`: Path to source point cloud file (required)
- `--target`: Path to target point cloud file (required)
- `--voxel-size`: Voxel size for downsampling (default: 0.05)
- `--max_iter_icp`: Maximum ICP iterations (default: 2000)
- `-v, --verbose`: Logging level - DEBUG, INFO, WARNING, ERROR, CRITICAL (default: INFO)

#### 2. Vanilla ICP Registration

```bash
uv run python scripts/icp_vanilla.py \
  --source data/source.ply \
  --target data/target.ply \
  --threshold 0.02 \
  -v INFO
```

**Options:**

- `--source`: Path to source point cloud file (required)
- `--target`: Path to target point cloud file (required)
- `--threshold`: Distance threshold for ICP (default: 0.02)
- `--max_iter_icp`: Maximum ICP iterations (default: 2000)
- `-v, --verbose`: Logging level (default: INFO)

#### 3. Load and Display Point Cloud

```bash
uv run python scripts/load_and_display.py \
  --input data/pointcloud.ply \
  -v INFO
```

**Options:**

- `--input`: Path to point cloud file (required)
- `-v, --verbose`: Logging level (default: INFO)

### Running Scripts with pip/venv

If using the traditional pip method, make sure your virtual environment is activated first:

```bash
# Activate virtual environment
source .venv/bin/activate  # macOS/Linux
# or
.venv\Scripts\activate  # Windows

# Run scripts
python scripts/global_registration.py --source data/source.ply --target data/target.ply --voxel-size 0.05
python scripts/icp_vanilla.py --source data/source.ply --target data/target.ply --threshold 0.02
python scripts/load_and_display.py --input data/pointcloud.ply
```

## Using the Package in Python

After installation, you can import and use the utilities in your own scripts:

```python
import numpy as np
from registration.utils.logging import setup_logging
from registration.utils.transforms import transformation_error
from registration.utils.metrics import compute_rmse_between_point_clouds
from registration.visualization.viewer import draw_registration_result

# Set up colored logging
setup_logging()

# Use transformation utilities
T_est = np.eye(4)
T_gt = np.eye(4)
rot_err, trans_err = transformation_error(T_est, T_gt)
```

## Running Tests

```bash
# With uv
uv run pytest

# With pip (after activating venv)
pytest

# With coverage report
uv run pytest --cov=src --cov-report=html
```

Test reports are generated in the `reports/` directory:

- `reports/coverage/` - HTML coverage report
- `reports/coverage.xml` - XML coverage report (for CI)
- `reports/coverage.json` - JSON coverage report

## License

[![FOSSA Status](https://app.fossa.com/api/projects/git%2Bgithub.com%2Fsimogasp%2Fpc_registration.svg?type=large)](https://app.fossa.com/projects/git%2Bgithub.com%2Fsimogasp%2Fpc_registration?ref=badge_large)
